{"ast":null,"code":"var _jsxFileName = \"D:\\\\Kltn\\\\test\\\\social-media\\\\client\\\\src\\\\components\\\\PostEdit\\\\index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport UserLayout from '../../hoc/user';\nimport { withRouter } from 'react-router-dom';\nimport FormField from '../ultils/Form/FormField';\nimport { populateOptionFields, update, ifFormValid, generateData, resetFields } from '../ultils/Form/FormActions';\nimport FileUpload from '../ultils/FileUpload';\nimport './postEdit.scss';\nimport 'react-autocomplete-input/dist/bundle.css';\nimport { getAllTags, getUserTag } from '../../actions/tag_actions';\nimport { clearProduct, updatePost } from '../../actions/product_actions';\nimport SearchLocationInput from '../SearchLocationInput/SearchLocationInput';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport MuiAlert from '@material-ui/lab/Alert';\n\nclass PostEdit extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      editlocation: false,\n      inputValue: \"\",\n      formError: false,\n      formSuccess: false,\n      formData: {\n        description: {\n          element: 'description',\n          value: '',\n          config: {\n            placeholder: 'Nói gì đó về bài viết này.....',\n            label: 'Mô tả',\n            name: 'description',\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: '',\n          showlabel: false\n        },\n        userTag: {\n          element: 'userTag',\n          value: '',\n          config: {\n            placeholder: 'Gắn thẻ bạn bè',\n            label: 'Gắn thẻ',\n            name: 'userTag',\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: '',\n          showlabel: false\n        },\n        locationInput: {\n          element: 'locationInput',\n          value: '',\n          config: {\n            placeholder: 'Thêm vị trí',\n            label: 'Vị trí',\n            name: 'location',\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: '',\n          showlabel: false\n        }\n      }\n    };\n\n    this.updateFields = newFormData => {\n      this.setState({\n        formData: newFormData\n      });\n    };\n\n    this.updateForm = element => {\n      const newFormdata = update(element, this.state.formData, 'posts');\n      this.setState({\n        formError: false,\n        formData: newFormdata\n      });\n    };\n\n    this.updateFields = newFormData => {\n      this.setState({\n        formData: newFormData\n      });\n    };\n\n    this.emojiToggle = () => {\n      this.setState({\n        emojiPicker: !this.state.emojiPicker\n      });\n    };\n\n    this.onEmojiClick = (event, emojiObject) => {\n      this.setState({\n        emojiObject: emojiObject\n      });\n    };\n\n    this.submitForm = event => {\n      event.preventDefault();\n      this.state.formData.locationInput.value = document.getElementById('input_value').value;\n      let data = generateData(this.state.formData, 'posts');\n      let formIsValid = ifFormValid(this.state.formData, 'posts');\n      let dataToSubmit = { ...data\n      };\n      dataToSubmit.postId = this.props.postId;\n      dataToSubmit.tags = this.findHashtags(data.description);\n      dataToSubmit.userTag = this.findUserTag(data.userTag);\n\n      if (formIsValid) {\n        console.log(dataToSubmit);\n        this.props.dispatch(updatePost(dataToSubmit, this.props.ActionType)).then(() => {\n          console.log(this.props.products);\n\n          if (this.props.products.updatePost) {\n            this.props.close();\n            this.props.handleSnackBar(\"Đã chỉnh sửa bài viết\", true);\n          } else {\n            this.setState({\n              formError: true\n            });\n            this.props.handleSnackBar(\"Đã xảy ra lỗi\", false);\n          }\n        });\n      } else {\n        this.setState({\n          formError: true\n        });\n      }\n    };\n\n    this.resetFieldHandler = () => {\n      const newFormData = resetFields(this.state.formData, 'posts');\n      this.setState({\n        formSuccess: true\n      });\n      setTimeout(() => {\n        this.setState({\n          formSuccess: false\n        }, () => {\n          this.props.dispatch(clearProduct());\n        });\n      }, 3000);\n    };\n  }\n\n  populateInput(formData, description, userTags) {\n    const newFormdata = { ...formData\n    };\n    const newDescription = { ...newFormdata[\"description\"]\n    };\n    const newUsertag = { ...newFormdata[\"userTag\"]\n    };\n    newDescription.value = description;\n    let usertag = \"\";\n    userTags.forEach(item => {\n      usertag += \"@\" + item.userName + \" \";\n    });\n    newUsertag.value = usertag;\n    newFormdata[\"description\"] = newDescription;\n    newFormdata[\"userTag\"] = newUsertag;\n    this.setState({\n      formData: newFormdata\n    });\n  }\n\n  componentDidMount() {\n    const formData = this.state.formData; //Gọi API lấy danh sách thẻ\n\n    this.props.dispatch(getAllTags()).then(response => {\n      const newFormData = populateOptionFields(formData, this.props.tags.allTags, 'description');\n      this.updateFields(newFormData);\n    });\n    this.props.dispatch(getUserTag()).then(response => {\n      const newFormData = populateOptionFields(formData, this.props.tags.userTags, 'userTag');\n      this.updateFields(newFormData);\n      this.populateInput(formData, this.props.description, this.props.userTag);\n    });\n  }\n\n  findHashtags(Text) {\n    var regexp = /\\B\\#\\w\\w+\\b/g;\n    let result = Text.match(regexp);\n\n    if (result) {\n      let tags = [];\n      result.forEach(item => {\n        tags.push(item.slice(1));\n      });\n      return tags;\n    } else {\n      return [];\n    }\n  }\n\n  findUserTag(Text) {\n    var regexp = /\\B\\@\\w\\w+\\b/g;\n    let result = Text.match(regexp);\n\n    if (result) {\n      let userTag = [];\n      result.forEach(item => {\n        userTag.push(item.slice(1));\n      });\n      return userTag;\n    } else {\n      return [];\n    }\n  }\n\n  render() {\n    const props = this.props;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"edit_post\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"create_post_form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-xl-12 no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 29\n      }\n    }, this.state.formData.description.value == \"\" ? /*#__PURE__*/React.createElement(Skeleton, {\n      variant: \"rect\",\n      width: '100%',\n      height: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 79\n      }\n    }) : /*#__PURE__*/React.createElement(FormField, {\n      id: 'description',\n      change: element => this.updateForm(element),\n      formData: this.state.formData.description,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 37\n      }\n    }), this.state.formData.description.value == \"\" ? /*#__PURE__*/React.createElement(Skeleton, {\n      variant: \"rect\",\n      width: '100%',\n      height: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 80\n      }\n    }) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"location_container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 33\n      }\n    }, this.state.editlocation ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"edit_location\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(SearchLocationInput, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 41\n      }\n    }), /*#__PURE__*/React.createElement(\"h5\", {\n      onClick: () => this.setState({\n        editlocation: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 41\n      }\n    }, \"H\\u1EE7y\")) : this.props.locationName ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"edit_location\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"search-location-input\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      value: this.props.locationName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 45\n      }\n    })), /*#__PURE__*/React.createElement(\"h5\", {\n      onClick: () => this.setState({\n        editlocation: true\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 41\n      }\n    }, \"S\\u1EEDa\")) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"edit_location\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(SearchLocationInput, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 41\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"field_container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 33\n      }\n    }, this.state.formData.description.value == \"\" ? /*#__PURE__*/React.createElement(Skeleton, {\n      variant: \"rect\",\n      width: '100%',\n      height: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 80\n      }\n    }) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(FormField, {\n      id: 'userTag',\n      change: element => this.updateForm(element),\n      formData: this.state.formData.userTag,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 37\n      }\n    }))), this.state.formData.description.value == \"\" ? /*#__PURE__*/React.createElement(Skeleton, {\n      variant: \"rect\",\n      width: 300,\n      height: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 79\n      }\n    }) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"button_wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"cancel_button\",\n      onClick: () => {\n        this.props.close();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 41\n      }\n    }, \"H\\u1EE7y\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"create_button\",\n      onClick: event => {\n        this.submitForm(event);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 41\n      }\n    }, \"L\\u01B0u\")), this.state.formError ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 37\n      }\n    }, \"H\\xE3y th\\xEAm \\u1EA3nh \\u0111\\u1EC3 \\u0111\\u0103ng b\\xE0i nh\\xE9 :( \") : /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 39\n      }\n    })))));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    tags: state.tags,\n    products: state.products\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(PostEdit));","map":{"version":3,"sources":["D:/Kltn/test/social-media/client/src/components/PostEdit/index.js"],"names":["React","Component","connect","UserLayout","withRouter","FormField","populateOptionFields","update","ifFormValid","generateData","resetFields","FileUpload","getAllTags","getUserTag","clearProduct","updatePost","SearchLocationInput","Skeleton","MuiAlert","PostEdit","state","editlocation","inputValue","formError","formSuccess","formData","description","element","value","config","placeholder","label","name","options","validation","required","valid","touched","validationMessage","showlabel","userTag","locationInput","updateFields","newFormData","setState","updateForm","newFormdata","emojiToggle","emojiPicker","onEmojiClick","event","emojiObject","submitForm","preventDefault","document","getElementById","data","formIsValid","dataToSubmit","postId","props","tags","findHashtags","findUserTag","console","log","dispatch","ActionType","then","products","close","handleSnackBar","resetFieldHandler","setTimeout","populateInput","userTags","newDescription","newUsertag","usertag","forEach","item","userName","componentDidMount","response","allTags","Text","regexp","result","match","push","slice","render","locationName","mapStateToProps","user"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport UserLayout from '../../hoc/user';\r\nimport { withRouter } from 'react-router-dom';\r\nimport FormField from '../ultils/Form/FormField';\r\nimport { populateOptionFields, update, ifFormValid, generateData, resetFields } from '../ultils/Form/FormActions';\r\nimport FileUpload from '../ultils/FileUpload';\r\nimport './postEdit.scss';\r\nimport 'react-autocomplete-input/dist/bundle.css';\r\nimport { getAllTags, getUserTag } from '../../actions/tag_actions';\r\nimport { clearProduct, updatePost } from '../../actions/product_actions';\r\nimport SearchLocationInput from '../SearchLocationInput/SearchLocationInput'\r\nimport Skeleton from '@material-ui/lab/Skeleton'\r\nimport MuiAlert from '@material-ui/lab/Alert';\r\n\r\nclass PostEdit extends Component {\r\n\r\n    state = {\r\n        editlocation: false,\r\n        inputValue: \"\",\r\n        formError: false,\r\n        formSuccess: false,\r\n        formData: {\r\n            description: {\r\n                element: 'description',\r\n                value: '',\r\n                config: {\r\n                    placeholder: 'Nói gì đó về bài viết này.....',\r\n                    label: 'Mô tả',\r\n                    name: 'description',\r\n                    options: [],\r\n                },\r\n                validation: {\r\n                    required: false,\r\n                },\r\n                valid: true,\r\n                touched: false,\r\n                validationMessage: '',\r\n                showlabel: false\r\n            },\r\n            userTag: {\r\n                element: 'userTag',\r\n                value: '',\r\n                config: {\r\n                    placeholder: 'Gắn thẻ bạn bè',\r\n                    label: 'Gắn thẻ',\r\n                    name: 'userTag',\r\n                   \r\n                    options: [],\r\n                },\r\n                validation: {\r\n                    required: false,\r\n                },\r\n                valid: true,\r\n                touched: false,\r\n                validationMessage: '',\r\n                showlabel: false\r\n            },\r\n            locationInput: {\r\n                element: 'locationInput',\r\n                value: '',\r\n                config: {\r\n                    placeholder: 'Thêm vị trí',\r\n                    label: 'Vị trí',\r\n                    name: 'location',\r\n                    options: [],\r\n                },\r\n                validation: {\r\n                    required: false,\r\n                },\r\n                valid: true,\r\n                touched: false,\r\n                validationMessage: '',\r\n                showlabel: false\r\n            }\r\n        },\r\n    }\r\n\r\n    populateInput(formData,description,userTags){\r\n\r\n        const newFormdata = { ...formData };\r\n\r\n        const newDescription = {\r\n            ...newFormdata[\"description\"]\r\n        }\r\n\r\n        const newUsertag = {\r\n            ...newFormdata[\"userTag\"]\r\n        }\r\n      \r\n        newDescription.value = description\r\n    \r\n        let usertag = \"\";\r\n        userTags.forEach((item)=>{\r\n            usertag += \"@\"+item.userName + \" \"\r\n        })\r\n\r\n        newUsertag.value = usertag\r\n\r\n        newFormdata[\"description\"] = newDescription;\r\n        newFormdata[\"userTag\"] = newUsertag;\r\n\r\n        this.setState({ formData: newFormdata });\r\n\r\n    }\r\n\r\n    updateFields = (newFormData) => {\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n    }\r\n\r\n    updateForm = (element) => {\r\n        const newFormdata = update(element, this.state.formData, 'posts');\r\n        this.setState({\r\n            formError: false,\r\n            formData: newFormdata\r\n        });\r\n    }\r\n\r\n    updateFields = (newFormData) => {\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n    }\r\n\r\n    componentDidMount() {\r\n        const formData = this.state.formData;\r\n        //Gọi API lấy danh sách thẻ\r\n        this.props.dispatch(getAllTags())\r\n            .then(response => {\r\n                const newFormData = populateOptionFields(formData, this.props.tags.allTags, 'description')\r\n                this.updateFields(newFormData)\r\n            })\r\n        this.props.dispatch(getUserTag())\r\n            .then(response => {\r\n                const newFormData = populateOptionFields(formData, this.props.tags.userTags, 'userTag')\r\n                this.updateFields(newFormData)\r\n                this.populateInput(formData, this.props.description, this.props.userTag)\r\n        })\r\n\r\n    }\r\n\r\n    emojiToggle = () => {\r\n        this.setState({ emojiPicker: !this.state.emojiPicker });\r\n    }\r\n\r\n    onEmojiClick = (event, emojiObject) => {\r\n        this.setState({ emojiObject: emojiObject });\r\n    }\r\n\r\n    findHashtags(Text) {\r\n        var regexp = /\\B\\#\\w\\w+\\b/g\r\n        let result = Text.match(regexp);\r\n\r\n        if (result) {\r\n            let tags = [];\r\n            result.forEach((item) => {\r\n                tags.push(item.slice(1));\r\n            })\r\n            return (tags);\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    findUserTag(Text) {\r\n        var regexp = /\\B\\@\\w\\w+\\b/g\r\n        let result = Text.match(regexp);\r\n\r\n        if (result) {\r\n            let userTag = []\r\n            result.forEach((item) => {\r\n                userTag.push(item.slice(1));\r\n            })\r\n            return (userTag);\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    submitForm = (event) => {\r\n\r\n        event.preventDefault();\r\n        this.state.formData.locationInput.value = document.getElementById('input_value').value\r\n        let data = generateData(this.state.formData, 'posts');\r\n        let formIsValid = ifFormValid(this.state.formData, 'posts');\r\n\r\n        let dataToSubmit = { ...data }\r\n        dataToSubmit.postId = this.props.postId\r\n        dataToSubmit.tags = this.findHashtags(data.description);\r\n        dataToSubmit.userTag = this.findUserTag(data.userTag);\r\n\r\n        if (formIsValid) {\r\n            console.log(dataToSubmit);\r\n            this.props.dispatch(updatePost(dataToSubmit,this.props.ActionType)).then(() => {\r\n                console.log(this.props.products);\r\n                if (this.props.products.updatePost) {\r\n                    this.props.close();\r\n                    this.props.handleSnackBar(\"Đã chỉnh sửa bài viết\",true)\r\n                } else {\r\n                    this.setState({ formError: true })\r\n                    this.props.handleSnackBar(\"Đã xảy ra lỗi\",false)\r\n                }\r\n            })\r\n        } else {\r\n            this.setState({\r\n                formError: true\r\n            })\r\n        }\r\n    }\r\n\r\n    resetFieldHandler = () => {\r\n        const newFormData = resetFields(this.state.formData, 'posts');\r\n        this.setState({\r\n            formSuccess: true\r\n        });\r\n        setTimeout(() => {\r\n            this.setState({\r\n                formSuccess: false\r\n            }, () => { this.props.dispatch(clearProduct()) })\r\n        }, 3000)\r\n    }\r\n\r\n    render() {\r\n        const props = this.props;\r\n        return (\r\n                <div className=\"edit_post\">\r\n                    <form class=\"create_post_form\">\r\n                        <div className=\"row no-gutters\">\r\n                            <div className='col-xl-12 no-gutters'>\r\n                                {\r\n                                this.state.formData.description.value == \"\" ? <Skeleton variant=\"rect\" width={'100%'} height={50} />:\r\n                                    <FormField\r\n                                        id={'description'}\r\n                                        change={(element) => this.updateForm(element)}\r\n                                        formData={this.state.formData.description}\r\n                                    />\r\n                                \r\n\r\n                                }\r\n                                {this.state.formData.description.value == \"\" ? <Skeleton variant=\"rect\" width={'100%'} height={50}  /> :\r\n                                <div className=\"location_container\">\r\n                                         {\r\n                                this.state.editlocation ?\r\n                                    <div className=\"edit_location\">\r\n                                        <SearchLocationInput></SearchLocationInput>\r\n                                        <h5 onClick={() => this.setState({ editlocation: false })}>Hủy</h5>\r\n                                    </div> : \r\n                                    this.props.locationName?\r\n                                    <div className=\"edit_location\">\r\n                                        <div className=\"search-location-input\">\r\n                                            <input\r\n                                                value={this.props.locationName}\r\n                                            />\r\n                                        </div>\r\n                                     \r\n                                        <h5 onClick={() => this.setState({ editlocation: true })}>Sửa</h5>\r\n                                    </div>\r\n                                    :\r\n                                    <div className=\"edit_location\">\r\n                                        <SearchLocationInput></SearchLocationInput>\r\n                                        {/* <h5 onClick={() => this.setState({ editlocation: false })}>Hủy</h5> */}\r\n                                    </div>\r\n                            }\r\n                                </div>\r\n                                }\r\n                                <div className=\"field_container\">\r\n                                {this.state.formData.description.value == \"\" ? <Skeleton variant=\"rect\" width={'100%'} height={50}  /> :\r\n                                    <div>\r\n                                    <FormField\r\n                                        id={'userTag'}\r\n                                        change={(element) => this.updateForm(element)}\r\n                                        formData={this.state.formData.userTag}\r\n                                    />\r\n                                    </div>\r\n                                }\r\n                                </div>\r\n                                {\r\n                                this.state.formData.description.value == \"\" ? <Skeleton variant=\"rect\" width={300} height={50} /> :\r\n                                    <div className=\"button_wrapper\">\r\n                                        <button className='cancel_button' onClick={() => {this.props.close()}}>Hủy</button>\r\n                                        <button className='create_button' onClick={(event) => { this.submitForm(event)}}>Lưu</button>\r\n                                \r\n                                    </div>\r\n                                }\r\n                                {\r\n                                    this.state.formError ?\r\n                                    <p>Hãy thêm ảnh để đăng bài nhé :( </p>\r\n                                    : <p></p>\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                    {/* <div>\r\n                        <SearchLocationInput onChange={() => {}}/>\r\n                    </div> */}\r\n                </div>\r\n        );\r\n    }\r\n}\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        user: state.user,\r\n        tags: state.tags,\r\n        products: state.products,\r\n    }\r\n}\r\nexport default connect(mapStateToProps)(withRouter(PostEdit));"]},"metadata":{},"sourceType":"module"}