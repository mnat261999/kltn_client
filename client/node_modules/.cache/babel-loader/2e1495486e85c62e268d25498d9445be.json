{"ast":null,"code":"var _jsxFileName = \"D:\\\\Kltn\\\\test\\\\social-media\\\\client\\\\src\\\\components\\\\Header_Footer\\\\Footer\\\\index.js\";\nimport React, { Component } from \"react\";\nimport \"./footer.scss\";\nimport Pusher, { Members } from \"pusher-js\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport faCompass from \"@fortawesome/fontawesome-free-solid/faCompass\";\nimport faPhone from \"@fortawesome/fontawesome-free-solid/faPhone\";\nimport faClock from \"@fortawesome/fontawesome-free-solid/faClock\";\nimport faEnvelope from \"@fortawesome/fontawesome-free-solid/faEnvelope\";\nimport { getIceServers } from \"../../../actions/message_action\";\nimport Collapse from \"@material-ui/core/Collapse\";\nimport { Point, Phone, Video, Microphone, MicrophoneOff, VideoOff, X } from \"tabler-icons-react\";\nimport Card from \"@material-ui/core/Card\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport ReactDOM from \"react-dom\";\n\nclass Footer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      checked: false,\n      onlineusers: [],\n      calling: false\n    };\n\n    this.prepareCaller = () => {\n      //Initializing a peer connection\n      var servers = {\n        iceServers: [{\n          url: \"stun:global.stun.twilio.com:3478?transport=udp\",\n          urls: \"stun:global.stun.twilio.com:3478?transport=udp\"\n        }, {\n          url: \"turn:global.turn.twilio.com:3478?transport=udp\",\n          username: \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\n          urls: \"turn:global.turn.twilio.com:3478?transport=udp\",\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\"\n        }, {\n          url: \"turn:global.turn.twilio.com:3478?transport=tcp\",\n          username: \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\n          urls: \"turn:global.turn.twilio.com:3478?transport=tcp\",\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\"\n        }, {\n          url: \"turn:global.turn.twilio.com:443?transport=tcp\",\n          username: \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\n          urls: \"turn:global.turn.twilio.com:443?transport=tcp\",\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\"\n        }]\n      };\n      this.caller = new window.RTCPeerConnection(servers); //Listen for ICE Candidates and send them to remote peers\n\n      this.caller.onicecandidate = evt => {\n        if (!evt.candidate) return;\n        console.log(\"onicecandidate called\");\n        this.onIceCandidate(this.caller, evt);\n      }; //onaddstream handler to receive remote feed and show in remoteview video element\n\n\n      this.caller.onaddstream = evt => {\n        console.log(\"onaddstream called\");\n\n        if (window.URL) {\n          document.getElementById(\"remoteview\").srcObject = evt.stream;\n          document.getElementById(\"remoteview\").play();\n          document.getElementById(\"remoteview\").muted = false;\n        } else {\n          document.getElementById(\"remoteview\").src = evt.stream;\n          document.getElementById(\"remoteview\").play();\n          document.getElementById(\"remoteview\").muted = false;\n        }\n      };\n    };\n\n    this.getCam = () => {\n      //Get local audio/video feed and show it in selfview video element\n      return navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      });\n    };\n\n    this.GetRTCIceCandidate = () => {\n      window.RTCIceCandidate = window.RTCIceCandidate || window.webkitRTCIceCandidate || window.mozRTCIceCandidate || window.msRTCIceCandidate;\n      return window.RTCIceCandidate;\n    };\n\n    this.GetRTCPeerConnection = () => {\n      window.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection || window.msRTCPeerConnection;\n      return window.RTCPeerConnection;\n    };\n\n    this.GetRTCSessionDescription = () => {\n      window.RTCSessionDescription = window.RTCSessionDescription || window.webkitRTCSessionDescription || window.mozRTCSessionDescription || window.msRTCSessionDescription;\n      return window.RTCSessionDescription;\n    };\n\n    this.callUser = user => {\n      this.getCam().then(stream => {\n        if (window.URL) {\n          document.getElementById(\"selfview\").srcObject = stream;\n          document.getElementById(\"selfview\").play(); // document.getElementById(\"selfview\").srcObject  =  stream;\n        } else {\n          document.getElementById(\"selfview\").src = stream;\n          document.getElementById(\"selfview\").play();\n        }\n\n        this.caller.addStream(stream);\n        this.localUserMedia = stream;\n        this.caller.createOffer().then(desc => {\n          this.caller.setLocalDescription(new RTCSessionDescription(desc));\n          this.channel.trigger(\"client-sdp\", {\n            sdp: desc,\n            room: user,\n            from: this.id,\n            userName: this.props.user.userData.userName,\n            avt: this.props.user.userData.avt\n          });\n          this.room = user;\n        });\n      }).catch(error => {\n        console.log(\"an error occured\", error);\n      });\n    };\n\n    this.endCall = () => {\n      this.room = null;\n      this.caller.close(); // ReactDOM.findDOMNode(this.remoteview).stop()\n      // ReactDOM.findDOMNode(this.selfview).stop()\n\n      for (let track of this.localUserMedia.getTracks()) {\n        track.stop();\n      }\n\n      this.prepareCaller();\n      ReactDOM.findDOMNode(this.videocall_contain).style.display = \"none\";\n    };\n\n    this.endCurrentCall = () => {\n      this.channel.trigger(\"client-endcall\", {\n        room: this.room\n      });\n      this.endCall();\n    };\n\n    this.onIceCandidate = (peer, evt) => {\n      if (evt.candidate) {\n        this.channel.trigger(\"client-candidate\", {\n          candidate: evt.candidate,\n          room: this.room\n        });\n      }\n    };\n\n    this.setVisable = () => {\n      ReactDOM.findDOMNode(this.videocall_contain).style.display = \"block\";\n    };\n\n    this.toggleCallUser = async userid => {\n      await this.setVisable();\n      await this.callUser(userid);\n    };\n\n    this.sessionDesc = null;\n    this.currentcaller = null;\n    this.room = null;\n    this.caller = null;\n    this.localUserMedia = null;\n    this.id = null;\n    this.userName = null;\n    this.avt = null;\n    this.channel = null;\n    this.usersOnline = 0;\n  }\n\n  componentDidMount() {\n    const script = document.createElement(\"script\");\n    script.src = \"https://js.pusher.com/4.1/pusher.min.js\";\n    script.async = true; //For head\n\n    document.head.appendChild(script); // For body\n\n    document.body.appendChild(script); // For component\n    //   this.div.appendChild(script);\n\n    const list = this.state.onlineusers;\n    const pusher = new Pusher(\"c0e96b0fff8d0edac17d\", {\n      cluster: \"mt1\",\n      encrypted: true,\n      authEndpoint: `http://localhost:3002/api/pusher/auth/${this.props.user.userData._id}`\n    });\n    var users = [],\n        sessionDesc,\n        caller,\n        localUserMedia;\n    this.channel = pusher.subscribe(\"presence-videocall\");\n    this.channel.bind(\"pusher:subscription_succeeded\", members => {\n      var me = this.channel.members.me;\n      this.usersOnline = this.channel.members.count;\n      this.id = me.id;\n      console.log(this.channel.members.me); //  document.getElementById('myid').innerHTML = ` My caller id is : ` + id;\n\n      this.channel.members.each(member => {\n        if (member.id != me.id) {\n          list.push(member.info);\n        }\n\n        console.log(list);\n      });\n      this.setState({\n        onlineusers: list\n      });\n    });\n    this.channel.bind(\"pusher:member_added\", member => {\n      list.push(member.info);\n      this.setState({\n        onlineusers: list\n      });\n    });\n    this.channel.bind(\"pusher:member_removed\", member => {\n      // for remove member from list:\n      var index = users.indexOf(member.id);\n      list.splice(index, 1); // if(member.id==room){\n      //     endCall();\n      // }\n\n      this.setState({\n        onlineusers: list\n      });\n    });\n    this.GetRTCPeerConnection();\n    this.GetRTCSessionDescription();\n    this.GetRTCIceCandidate();\n    this.prepareCaller();\n    this.channel.bind(\"client-candidate\", msg => {\n      if (msg.room == this.room) {\n        console.log(\"candidate received\");\n        this.caller.addIceCandidate(new RTCIceCandidate(msg.candidate));\n      }\n    }); //Listening for Session Description Protocol message with session details from remote peer\n\n    this.channel.bind(\"client-sdp\", msg => {\n      if (msg.room == this.id) {\n        var sessionDesc = new RTCSessionDescription(msg.sdp);\n        this.caller.setRemoteDescription(sessionDesc);\n        console.log(\"sdp received\");\n        var answer = window.confirm(\"Bạn có cuộc gọi từ: \" + msg.userName + \" bạn có muốn nhận?\");\n\n        if (!answer) {\n          return this.channel.trigger(\"client-reject\", {\n            room: msg.room,\n            rejected: this.id\n          });\n        }\n\n        ReactDOM.findDOMNode(this.videocall_contain).style.display = \"block\";\n        this.room = msg.room;\n        this.getCam().then(stream => {\n          this.localUserMedia = stream;\n\n          if (window.URL) {\n            document.getElementById(\"selfview\").srcObject = stream;\n            document.getElementById(\"selfview\").play();\n          } else {\n            document.getElementById(\"selfview\").src = stream;\n            document.getElementById(\"selfview\").play();\n          }\n\n          this.caller.addStream(stream);\n          this.caller.createAnswer().then(sdp => {\n            this.caller.setLocalDescription(new RTCSessionDescription(sdp));\n            this.channel.trigger(\"client-answer\", {\n              sdp: sdp,\n              room: this.room\n            });\n          });\n        }).catch(error => {\n          console.log(\"an error occured\", error);\n        });\n      }\n    }); //Listening for answer to offer sent to remote peer\n\n    this.channel.bind(\"client-answer\", answer => {\n      if (answer.room == this.room) {\n        console.log(\"answer received\");\n        this.caller.setRemoteDescription(new RTCSessionDescription(answer.sdp));\n      }\n    });\n    this.channel.bind(\"client-reject\", answer => {\n      if (answer.room == this.room) {\n        console.log(\"Call declined\");\n        alert(\"call to \" + answer.rejected + \"was politely declined\");\n        ReactDOM.findDOMNode(this.videocall_contain).style.display = \"none\";\n        this.endCall();\n      }\n    });\n    this.channel.bind(\"client-endcall\", answer => {\n      if (answer.room == this.room) {\n        console.log(\"Call Ended\");\n        this.endCall();\n      }\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"videocall_contain\",\n      ref: n => this.videocall_contain = n,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"videocall\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      muted: \"muted\",\n      id: \"selfview\",\n      ref: n => this.selfview = n,\n      autoplay: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"video\", {\n      muted: \"muted\",\n      id: \"remoteview\",\n      ref: n => this.remoteview = n,\n      autoplay: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"action_button\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Video, {\n      strokeWidth: 1,\n      fill: \"white\",\n      color: \"#0070F2\",\n      id: \"video_button\",\n      size: 30,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 15\n      }\n    }, \" \"), /*#__PURE__*/React.createElement(Microphone, {\n      strokeWidth: 1.5,\n      color: \"white\",\n      id: \"audio_button\",\n      size: 30,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(X, {\n      onClick: () => this.endCurrentCall(),\n      strokeWidth: 1.5,\n      color: \"white\",\n      id: \"exit_button\",\n      size: 30,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 15\n      }\n    }, \" \")))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"footer container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"footer__container container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-lg-9 col-md-6 col-sm-4 col-4 no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-lg-3 col-md-6 col-sm-8 col-8  no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"footer__container__left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Collapse, {\n      onClick: () => this.setState({\n        checked: !this.state.checked\n      }),\n      in: this.state.checked,\n      collapsedHeight: 40,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Card, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"active_footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"title_footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 27\n      }\n    }, \"\\u0110ang ho\\u1EA1t \\u0111\\u1ED9ng (\", this.state.onlineusers.length, \")\"), /*#__PURE__*/React.createElement(Point, {\n      size: 20,\n      strokeWidth: 7,\n      color: \"#5fdba7\",\n      fill: \"#5fdba7\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 27\n      }\n    })), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"user_contain\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 25\n      }\n    }, this.state.onlineusers.map(user => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"uinfo\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 31\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: user.avt,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 33\n        }\n      }), /*#__PURE__*/React.createElement(\"a\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 33\n        }\n      }, user.userName), /*#__PURE__*/React.createElement(Phone, {\n        onClick: () => {\n          this.toggleCallUser(user.id);\n        },\n        className: \"phone_icon\",\n        size: 24,\n        strokeWidth: 0.5,\n        color: \"black\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 33\n        }\n      }));\n    })))))))))));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    notification: state.notification,\n    messages: state.messages\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Footer));","map":{"version":3,"sources":["D:/Kltn/test/social-media/client/src/components/Header_Footer/Footer/index.js"],"names":["React","Component","Pusher","Members","FontAwesomeIcon","faCompass","faPhone","faClock","faEnvelope","getIceServers","Collapse","Point","Phone","Video","Microphone","MicrophoneOff","VideoOff","X","Card","Link","withRouter","connect","ReactDOM","Footer","constructor","props","state","checked","onlineusers","calling","prepareCaller","servers","iceServers","url","urls","username","credential","caller","window","RTCPeerConnection","onicecandidate","evt","candidate","console","log","onIceCandidate","onaddstream","URL","document","getElementById","srcObject","stream","play","muted","src","getCam","navigator","mediaDevices","getUserMedia","video","audio","GetRTCIceCandidate","RTCIceCandidate","webkitRTCIceCandidate","mozRTCIceCandidate","msRTCIceCandidate","GetRTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","msRTCPeerConnection","GetRTCSessionDescription","RTCSessionDescription","webkitRTCSessionDescription","mozRTCSessionDescription","msRTCSessionDescription","callUser","user","then","addStream","localUserMedia","createOffer","desc","setLocalDescription","channel","trigger","sdp","room","from","id","userName","userData","avt","catch","error","endCall","close","track","getTracks","stop","findDOMNode","videocall_contain","style","display","endCurrentCall","peer","setVisable","toggleCallUser","userid","sessionDesc","currentcaller","usersOnline","componentDidMount","script","createElement","async","head","appendChild","body","list","pusher","cluster","encrypted","authEndpoint","_id","users","subscribe","bind","members","me","count","each","member","push","info","setState","index","indexOf","splice","msg","addIceCandidate","setRemoteDescription","answer","confirm","rejected","createAnswer","alert","render","n","selfview","remoteview","length","map","mapStateToProps","notification","messages"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport \"./footer.scss\";\r\nimport Pusher, { Members } from \"pusher-js\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport faCompass from \"@fortawesome/fontawesome-free-solid/faCompass\";\r\nimport faPhone from \"@fortawesome/fontawesome-free-solid/faPhone\";\r\nimport faClock from \"@fortawesome/fontawesome-free-solid/faClock\";\r\nimport faEnvelope from \"@fortawesome/fontawesome-free-solid/faEnvelope\";\r\nimport { getIceServers } from \"../../../actions/message_action\";\r\nimport Collapse from \"@material-ui/core/Collapse\";\r\nimport {\r\n  Point,\r\n  Phone,\r\n  Video,\r\n  Microphone,\r\n  MicrophoneOff,\r\n  VideoOff,\r\n  X,\r\n} from \"tabler-icons-react\";\r\nimport Card from \"@material-ui/core/Card\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport ReactDOM from \"react-dom\";\r\n\r\nclass Footer extends Component {\r\n  state = {\r\n    checked: false,\r\n    onlineusers: [],\r\n    calling: false,\r\n  };\r\n  constructor(props) {\r\n    super(props);\r\n    this.sessionDesc = null;\r\n    this.currentcaller = null;\r\n    this.room = null;\r\n    this.caller = null;\r\n    this.localUserMedia = null;\r\n    this.id = null;\r\n    this.userName = null;\r\n    this.avt = null;\r\n    this.channel = null;\r\n    this.usersOnline = 0;\r\n  }\r\n  prepareCaller = () => {\r\n    //Initializing a peer connection\r\n    var servers = {\r\n      iceServers: [\r\n        {\r\n          url: \"stun:global.stun.twilio.com:3478?transport=udp\",\r\n          urls: \"stun:global.stun.twilio.com:3478?transport=udp\",\r\n        },\r\n        {\r\n          url: \"turn:global.turn.twilio.com:3478?transport=udp\",\r\n          username:\r\n            \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\r\n          urls: \"turn:global.turn.twilio.com:3478?transport=udp\",\r\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\",\r\n        },\r\n        {\r\n          url: \"turn:global.turn.twilio.com:3478?transport=tcp\",\r\n          username:\r\n            \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\r\n          urls: \"turn:global.turn.twilio.com:3478?transport=tcp\",\r\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\",\r\n        },\r\n        {\r\n          url: \"turn:global.turn.twilio.com:443?transport=tcp\",\r\n          username:\r\n            \"68e4f24ef90901b45e096ebc937611bb27c33656214c08d4b1885c9c19c240f1\",\r\n          urls: \"turn:global.turn.twilio.com:443?transport=tcp\",\r\n          credential: \"3rxn3/JfFZpyRMIU+j/8kuEvmhyihxy++8Icf+/LTFw=\",\r\n        },\r\n      ],\r\n    };\r\n    this.caller = new window.RTCPeerConnection(servers);\r\n    //Listen for ICE Candidates and send them to remote peers\r\n    this.caller.onicecandidate = (evt) => {\r\n      if (!evt.candidate) return;\r\n      console.log(\"onicecandidate called\");\r\n      this.onIceCandidate(this.caller, evt);\r\n    };\r\n    //onaddstream handler to receive remote feed and show in remoteview video element\r\n    this.caller.onaddstream = (evt) => {\r\n      console.log(\"onaddstream called\");\r\n      if (window.URL) {\r\n        document.getElementById(\"remoteview\").srcObject = evt.stream;\r\n        document.getElementById(\"remoteview\").play();\r\n        document.getElementById(\"remoteview\").muted = false;\r\n      } else {\r\n        document.getElementById(\"remoteview\").src = evt.stream;\r\n        document.getElementById(\"remoteview\").play();\r\n        document.getElementById(\"remoteview\").muted = false;\r\n      }\r\n    };\r\n  };\r\n  getCam = () => {\r\n    //Get local audio/video feed and show it in selfview video element\r\n    return navigator.mediaDevices.getUserMedia({\r\n      video: true,\r\n      audio: true,\r\n    });\r\n  };\r\n\r\n  GetRTCIceCandidate = () => {\r\n    window.RTCIceCandidate =\r\n      window.RTCIceCandidate ||\r\n      window.webkitRTCIceCandidate ||\r\n      window.mozRTCIceCandidate ||\r\n      window.msRTCIceCandidate;\r\n\r\n    return window.RTCIceCandidate;\r\n  };\r\n\r\n  GetRTCPeerConnection = () => {\r\n    window.RTCPeerConnection =\r\n      window.RTCPeerConnection ||\r\n      window.webkitRTCPeerConnection ||\r\n      window.mozRTCPeerConnection ||\r\n      window.msRTCPeerConnection;\r\n    return window.RTCPeerConnection;\r\n  };\r\n\r\n  GetRTCSessionDescription = () => {\r\n    window.RTCSessionDescription =\r\n      window.RTCSessionDescription ||\r\n      window.webkitRTCSessionDescription ||\r\n      window.mozRTCSessionDescription ||\r\n      window.msRTCSessionDescription;\r\n    return window.RTCSessionDescription;\r\n  };\r\n\r\n  //Create and send offer to remote peer on button click\r\n  callUser = (user) => {\r\n    this.getCam()\r\n      .then((stream) => {\r\n        if (window.URL) {\r\n          document.getElementById(\"selfview\").srcObject = stream;\r\n          document.getElementById(\"selfview\").play();\r\n          // document.getElementById(\"selfview\").srcObject  =  stream;\r\n        } else {\r\n          document.getElementById(\"selfview\").src = stream;\r\n          document.getElementById(\"selfview\").play();\r\n        }\r\n\r\n        this.caller.addStream(stream);\r\n        this.localUserMedia = stream;\r\n        this.caller.createOffer().then((desc) => {\r\n          this.caller.setLocalDescription(new RTCSessionDescription(desc));\r\n          this.channel.trigger(\"client-sdp\", {\r\n            sdp: desc,\r\n            room: user,\r\n            from: this.id,\r\n            userName: this.props.user.userData.userName,\r\n            avt: this.props.user.userData.avt,\r\n          });\r\n          this.room = user;\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        console.log(\"an error occured\", error);\r\n      });\r\n  };\r\n\r\n  endCall = () => {\r\n    this.room = null;\r\n    this.caller.close();\r\n    // ReactDOM.findDOMNode(this.remoteview).stop()\r\n    // ReactDOM.findDOMNode(this.selfview).stop()\r\n    for (let track of this.localUserMedia.getTracks()) {\r\n      track.stop();\r\n    }\r\n    this.prepareCaller();\r\n    ReactDOM.findDOMNode(this.videocall_contain).style.display = \"none\";\r\n  };\r\n\r\n  endCurrentCall = () => {\r\n    this.channel.trigger(\"client-endcall\", {\r\n      room: this.room,\r\n    });\r\n    this.endCall();\r\n  };\r\n  onIceCandidate = (peer, evt) => {\r\n    if (evt.candidate) {\r\n      this.channel.trigger(\"client-candidate\", {\r\n        candidate: evt.candidate,\r\n        room: this.room,\r\n      });\r\n    }\r\n  };\r\n\r\n  setVisable = () => {\r\n    ReactDOM.findDOMNode(this.videocall_contain).style.display = \"block\";\r\n  };\r\n\r\n  toggleCallUser = async (userid) => {\r\n    await this.setVisable();\r\n    await this.callUser(userid);\r\n  };\r\n\r\n  componentDidMount() {\r\n    const script = document.createElement(\"script\");\r\n    script.src = \"https://js.pusher.com/4.1/pusher.min.js\";\r\n    script.async = true;\r\n\r\n    //For head\r\n    document.head.appendChild(script);\r\n\r\n    // For body\r\n    document.body.appendChild(script);\r\n\r\n    // For component\r\n    //   this.div.appendChild(script);\r\n    const list = this.state.onlineusers;\r\n    const pusher = new Pusher(\"c0e96b0fff8d0edac17d\", {\r\n      cluster: \"mt1\",\r\n      encrypted: true,\r\n      authEndpoint: `http://localhost:3002/api/pusher/auth/${this.props.user.userData._id}`,\r\n    });\r\n    var users = [],\r\n      sessionDesc,\r\n      caller,\r\n      localUserMedia;\r\n    this.channel = pusher.subscribe(\"presence-videocall\");\r\n    this.channel.bind(\"pusher:subscription_succeeded\", (members) => {\r\n      var me = this.channel.members.me;\r\n      this.usersOnline = this.channel.members.count;\r\n      this.id = me.id;\r\n      console.log(this.channel.members.me);\r\n\r\n      //  document.getElementById('myid').innerHTML = ` My caller id is : ` + id;\r\n      this.channel.members.each((member) => {\r\n        if (member.id != me.id) {\r\n          list.push(member.info);\r\n        }\r\n        console.log(list);\r\n      });\r\n      this.setState({ onlineusers: list });\r\n    });\r\n\r\n    this.channel.bind(\"pusher:member_added\", (member) => {\r\n      list.push(member.info);\r\n      this.setState({ onlineusers: list });\r\n    });\r\n    this.channel.bind(\"pusher:member_removed\", (member) => {\r\n      // for remove member from list:\r\n      var index = users.indexOf(member.id);\r\n      list.splice(index, 1);\r\n      // if(member.id==room){\r\n      //     endCall();\r\n      // }\r\n      this.setState({ onlineusers: list });\r\n    });\r\n    this.GetRTCPeerConnection();\r\n    this.GetRTCSessionDescription();\r\n    this.GetRTCIceCandidate();\r\n    this.prepareCaller();\r\n\r\n    this.channel.bind(\"client-candidate\", (msg) => {\r\n      if (msg.room == this.room) {\r\n        console.log(\"candidate received\");\r\n        this.caller.addIceCandidate(new RTCIceCandidate(msg.candidate));\r\n      }\r\n    });\r\n\r\n    //Listening for Session Description Protocol message with session details from remote peer\r\n    this.channel.bind(\"client-sdp\", (msg) => {\r\n      if (msg.room == this.id) {\r\n        var sessionDesc = new RTCSessionDescription(msg.sdp);\r\n        this.caller.setRemoteDescription(sessionDesc);\r\n        console.log(\"sdp received\");\r\n        var answer = window.confirm(\r\n          \"Bạn có cuộc gọi từ: \" + msg.userName + \" bạn có muốn nhận?\"\r\n        );\r\n        if (!answer) {\r\n          return this.channel.trigger(\"client-reject\", {\r\n            room: msg.room,\r\n            rejected: this.id,\r\n          });\r\n        }\r\n        ReactDOM.findDOMNode(this.videocall_contain).style.display = \"block\";\r\n        this.room = msg.room;\r\n        this.getCam()\r\n          .then((stream) => {\r\n            this.localUserMedia = stream;\r\n            if (window.URL) {\r\n              document.getElementById(\"selfview\").srcObject = stream;\r\n              document.getElementById(\"selfview\").play();\r\n            } else {\r\n              document.getElementById(\"selfview\").src = stream;\r\n              document.getElementById(\"selfview\").play();\r\n            }\r\n            this.caller.addStream(stream);\r\n\r\n            this.caller.createAnswer().then((sdp) => {\r\n              this.caller.setLocalDescription(new RTCSessionDescription(sdp));\r\n              this.channel.trigger(\"client-answer\", {\r\n                sdp: sdp,\r\n                room: this.room,\r\n              });\r\n            });\r\n          })\r\n          .catch((error) => {\r\n            console.log(\"an error occured\", error);\r\n          });\r\n      }\r\n    });\r\n\r\n    //Listening for answer to offer sent to remote peer\r\n    this.channel.bind(\"client-answer\", (answer) => {\r\n      if (answer.room == this.room) {\r\n        console.log(\"answer received\");\r\n        this.caller.setRemoteDescription(new RTCSessionDescription(answer.sdp));\r\n      }\r\n    });\r\n\r\n    this.channel.bind(\"client-reject\", (answer) => {\r\n      if (answer.room == this.room) {\r\n        console.log(\"Call declined\");\r\n        alert(\"call to \" + answer.rejected + \"was politely declined\");\r\n        ReactDOM.findDOMNode(this.videocall_contain).style.display = \"none\";\r\n        this.endCall();\r\n      }\r\n    });\r\n\r\n    this.channel.bind(\"client-endcall\", (answer) => {\r\n      if (answer.room == this.room) {\r\n        console.log(\"Call Ended\");\r\n        this.endCall();\r\n      }\r\n    });\r\n  }\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div id=\"videocall_contain\" ref={(n) => (this.videocall_contain = n)}>\r\n          <div className=\"videocall\">\r\n            <video\r\n              muted=\"muted\"\r\n              id=\"selfview\"\r\n              ref={(n) => (this.selfview = n)}\r\n              autoplay\r\n            ></video>\r\n            <video\r\n              muted=\"muted\"\r\n              id=\"remoteview\"\r\n              ref={(n) => (this.remoteview = n)}\r\n              autoplay\r\n            ></video>\r\n            <div className=\"action_button\">\r\n              <Video\r\n                strokeWidth={1}\r\n                fill=\"white\"\r\n                color=\"#0070F2\"\r\n                id=\"video_button\"\r\n                size={30}\r\n              >\r\n                {\" \"}\r\n              </Video>\r\n              <Microphone\r\n                strokeWidth={1.5}\r\n                color=\"white\"\r\n                id=\"audio_button\"\r\n                size={30}\r\n              ></Microphone>\r\n              <X\r\n                onClick={() => this.endCurrentCall()}\r\n                strokeWidth={1.5}\r\n                color=\"white\"\r\n                id=\"exit_button\"\r\n                size={30}\r\n              >\r\n                {\" \"}\r\n              </X>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"footer container-fluid\">\r\n          <div className=\"footer__container container-fluid\">\r\n            <div className=\"row no-gutters\">\r\n              <div className=\"col-lg-9 col-md-6 col-sm-4 col-4 no-gutters\"></div>\r\n              <div className=\"col-lg-3 col-md-6 col-sm-8 col-8  no-gutters\">\r\n                <div className=\"footer__container__left\">\r\n                  <Collapse\r\n                    onClick={() =>\r\n                      this.setState({ checked: !this.state.checked })\r\n                    }\r\n                    in={this.state.checked}\r\n                    collapsedHeight={40}\r\n                  >\r\n                    <Card>\r\n                      <div className=\"active_footer\">\r\n                        <div className=\"title_footer\">\r\n                          <h4>\r\n                            Đang hoạt động ({this.state.onlineusers.length})\r\n                          </h4>\r\n                          <Point\r\n                            size={20}\r\n                            strokeWidth={7}\r\n                            color=\"#5fdba7\"\r\n                            fill=\"#5fdba7\"\r\n                          ></Point>\r\n                        </div>\r\n                        <hr></hr>\r\n                        <div className=\"user_contain\">\r\n                          {this.state.onlineusers.map((user) => {\r\n                            return (\r\n                              <div className=\"uinfo\">\r\n                                <img src={user.avt}></img>\r\n                                <a>{user.userName}</a>\r\n\r\n                                <Phone\r\n                                  onClick={() => {\r\n                                    this.toggleCallUser(user.id);\r\n                                  }}\r\n                                  className=\"phone_icon\"\r\n                                  size={24}\r\n                                  strokeWidth={0.5}\r\n                                  color=\"black\"\r\n                                ></Phone>\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      </div>\r\n                    </Card>\r\n                  </Collapse>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    user: state.user,\r\n    notification: state.notification,\r\n    messages: state.messages,\r\n  };\r\n}\r\nexport default connect(mapStateToProps)(withRouter(Footer));\r\n"]},"metadata":{},"sourceType":"module"}