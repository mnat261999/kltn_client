{"ast":null,"code":"var _jsxFileName = \"D:\\\\Kltn\\\\test\\\\social-media\\\\client\\\\src\\\\components\\\\User\\\\index.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport Layout from \"../../hoc/layout\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport FormField from \"../ultils/Form/FormField\";\nimport { populateOptionFields, update, ifFormValid, generateData, resetFields } from \"../ultils/Form/FormActions\";\nimport FileUpload from \"../ultils/FileUpload\";\nimport \"./createPostForm.scss\";\nimport \"react-autocomplete-input/dist/bundle.css\";\nimport { getAllTags, getUserTag } from \"../../actions/tag_actions\";\nimport { clearProduct, createPost } from \"../../actions/product_actions\";\nimport SearchLocationInput from \"../SearchLocationInput/SearchLocationInput\";\nimport { startSession } from \"mongoose\";\nimport moment from \"moment\";\nimport Slide from \"@material-ui/core/Slide\";\nimport { Dialog } from \"@material-ui/core\";\nconst Transition = React.forwardRef(function Transition(props, ref) {\n  return /*#__PURE__*/React.createElement(Slide, Object.assign({\n    direction: \"up\",\n    ref: ref\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 10\n    }\n  }));\n});\n\nclass UserDashboard extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      inputValue: \"\",\n      formError: false,\n      formSuccess: false,\n      formData: {\n        description: {\n          element: \"description\",\n          value: \"\",\n          config: {\n            placeholder: \"Nói gì đó về bài viết này.....\",\n            label: \"Mô tả\",\n            name: \"description\",\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: \"\",\n          showlabel: false\n        },\n        userTag: {\n          element: \"userTag\",\n          value: \"\",\n          config: {\n            placeholder: \"Gắn thẻ bạn bè\",\n            label: \"Gắn thẻ\",\n            name: \"userTag\",\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: \"\",\n          showlabel: false\n        },\n        locationInput: {\n          element: \"locationInput\",\n          value: \"\",\n          config: {\n            placeholder: \"Thêm vị trí\",\n            label: \"Vị trí\",\n            name: \"location\",\n            options: []\n          },\n          validation: {\n            required: false\n          },\n          valid: true,\n          touched: false,\n          validationMessage: \"\",\n          showlabel: false\n        },\n        images: {\n          element: \"select\",\n          value: [],\n          validation: {\n            required: true\n          },\n          valid: false,\n          touched: false,\n          validationMessage: \"\",\n          showlabel: false\n        }\n      },\n      setfollowerDiaglog: false,\n      alertFunctionIsRestricted: false,\n      restrictedFunction: {}\n    };\n\n    this.updateFields = newFormData => {\n      this.setState({\n        formData: newFormData\n      });\n    };\n\n    this.updateDescription = newFormdata => {\n      this.setState(prevState => ({\n        formError: false,\n        formData: newFormdata\n      }));\n    };\n\n    this.updateForm = element => {\n      const newFormdata = update(element, this.state.formData, \"posts\");\n      console.log(newFormdata);\n      this.updateDescription(newFormdata);\n    };\n\n    this.updateFields = newFormData => {\n      this.setState({\n        formData: newFormData\n      });\n    };\n\n    this.imagesHandler = images => {\n      const newFormData = { ...this.state.formData\n      };\n      newFormData[\"images\"].value = images;\n      images.length ? newFormData[\"images\"].valid = true : newFormData[\"images\"].valid = false;\n      this.setState({\n        formData: newFormData\n      });\n      console.log(this.state.formData);\n    };\n\n    this.emojiToggle = () => {\n      this.setState({\n        emojiPicker: !this.state.emojiPicker\n      });\n    };\n\n    this.onEmojiClick = (event, emojiObject) => {\n      this.setState({\n        emojiObject: emojiObject\n      });\n    };\n\n    this.submitForm = event => {\n      event.preventDefault();\n      this.state.formData.locationInput.value = document.getElementById(\"input_value\").value;\n      let data = generateData(this.state.formData, \"posts\");\n      let formIsValid = ifFormValid(this.state.formData, \"posts\");\n      let dataToSubmit = { ...data\n      };\n      dataToSubmit.tags = this.findHashtags(data.description);\n      dataToSubmit.userTag = this.findUserTag(data.userTag);\n      console.log(dataToSubmit);\n\n      if (formIsValid) {\n        console.log(dataToSubmit);\n        this.props.dispatch(createPost(dataToSubmit)).then(response => {\n          if (response.payload.restricted) {\n            console.log(response.payload);\n            this.setState({\n              alertFunctionIsRestricted: true,\n              restrictedFunction: response.payload.restrictedFunction\n            });\n          } else {\n            console.log(this.props.products);\n\n            if (this.props.products.addProduct.success) {\n              this.props.history.push(\"/newfeed\");\n            } else {\n              this.setState({\n                formError: true\n              });\n            }\n          }\n        });\n      } else {\n        this.setState({\n          formError: true\n        });\n      }\n    };\n\n    this.resetFieldHandler = () => {\n      const newFormData = resetFields(this.state.formData, \"posts\");\n      this.setState({\n        formSuccess: true\n      });\n      setTimeout(() => {\n        this.setState({\n          formSuccess: false\n        }, () => {\n          this.props.dispatch(clearProduct());\n        });\n      }, 3000);\n    };\n  }\n\n  componentDidMount() {\n    const formData = this.state.formData; //Gọi API lấy danh sách thẻ\n\n    this.props.dispatch(getAllTags()).then(response => {\n      const newFormData = populateOptionFields(formData, this.props.tags.allTags, \"description\");\n      this.updateFields(newFormData);\n    });\n    this.props.dispatch(getUserTag()).then(response => {\n      const newFormData = populateOptionFields(formData, this.props.tags.userTags, \"userTag\");\n      this.updateFields(newFormData);\n    });\n  }\n\n  findHashtags(Text) {\n    var regexp = /\\B\\#\\w\\w+\\b/g;\n    let result = Text.match(regexp);\n\n    if (result) {\n      let tags = [];\n      result.forEach(item => {\n        tags.push(item.slice(1));\n      });\n      return tags;\n    } else {\n      return [];\n    }\n  }\n\n  findUserTag(Text) {\n    var regexp = /\\B\\@\\w\\w+\\b/g;\n    let result = Text.match(regexp);\n\n    if (result) {\n      let userTag = [];\n      result.forEach(item => {\n        userTag.push(item.slice(1));\n      });\n      return userTag;\n    } else {\n      return [];\n    }\n  }\n\n  render() {\n    const props = this.props;\n    return /*#__PURE__*/React.createElement(Layout, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"create_post\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"create_post_form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-xl-12 col-sm-12 col-12 no-gutters\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"user_info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"avatar\",\n      src: props.user.userData.avt,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"h5\", {\n      className: \"userName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 19\n      }\n    }, props.user.userData.userName)), /*#__PURE__*/React.createElement(FormField, {\n      id: \"description\",\n      change: element => this.updateForm(element),\n      formData: this.state.formData.description,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"field_container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(FormField, {\n      id: \"userTag\",\n      change: element => this.updateForm(element),\n      formData: this.state.formData.userTag,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SearchLocationInput, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(FileUpload, {\n      imagesHandler: images => this.imagesHandler(images),\n      reset: this.state.formSuccess,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"create_button\",\n      onClick: event => {\n        this.submitForm(event);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 17\n      }\n    }, \"\\u0110\\u0103ng b\\xE0i\"), this.state.formError ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 19\n      }\n    }, \"H\\xE3y th\\xEAm \\u1EA3nh \\u0111\\u1EC3 \\u0111\\u0103ng b\\xE0i nh\\xE9 :( \") : /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 19\n      }\n    }))))), /*#__PURE__*/React.createElement(Dialog, {\n      className: \"dialog_cont\",\n      onClose: () => {\n        this.setState({\n          alertFunctionIsRestricted: false\n        });\n      },\n      open: this.state.alertFunctionIsRestricted,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"dialog_header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 13\n      }\n    }, \"Ba\\u0323n \\u0111a\\u0303 bi\\u0323 ha\\u0323n ch\\xEA\\u0301 ch\\u01B0\\u0301c n\\u0103ng na\\u0300y cho \\u0111\\xEA\\u0301n\", \" \", moment(this.state.restrictedFunction.amountOfTime).format(\"L\")))));\n  }\n\n}\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    tags: state.tags,\n    products: state.products\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(UserDashboard));","map":{"version":3,"sources":["D:/Kltn/test/social-media/client/src/components/User/index.js"],"names":["React","Component","connect","Layout","Link","withRouter","FormField","populateOptionFields","update","ifFormValid","generateData","resetFields","FileUpload","getAllTags","getUserTag","clearProduct","createPost","SearchLocationInput","startSession","moment","Slide","Dialog","Transition","forwardRef","props","ref","UserDashboard","state","inputValue","formError","formSuccess","formData","description","element","value","config","placeholder","label","name","options","validation","required","valid","touched","validationMessage","showlabel","userTag","locationInput","images","setfollowerDiaglog","alertFunctionIsRestricted","restrictedFunction","updateFields","newFormData","setState","updateDescription","newFormdata","prevState","updateForm","console","log","imagesHandler","length","emojiToggle","emojiPicker","onEmojiClick","event","emojiObject","submitForm","preventDefault","document","getElementById","data","formIsValid","dataToSubmit","tags","findHashtags","findUserTag","dispatch","then","response","payload","restricted","products","addProduct","success","history","push","resetFieldHandler","setTimeout","componentDidMount","allTags","userTags","Text","regexp","result","match","forEach","item","slice","render","user","userData","avt","userName","amountOfTime","format","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport Layout from \"../../hoc/layout\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\nimport FormField from \"../ultils/Form/FormField\";\r\nimport {\r\n  populateOptionFields,\r\n  update,\r\n  ifFormValid,\r\n  generateData,\r\n  resetFields,\r\n} from \"../ultils/Form/FormActions\";\r\nimport FileUpload from \"../ultils/FileUpload\";\r\nimport \"./createPostForm.scss\";\r\nimport \"react-autocomplete-input/dist/bundle.css\";\r\nimport { getAllTags, getUserTag } from \"../../actions/tag_actions\";\r\nimport { clearProduct, createPost } from \"../../actions/product_actions\";\r\nimport SearchLocationInput from \"../SearchLocationInput/SearchLocationInput\";\r\nimport { startSession } from \"mongoose\";\r\nimport moment from \"moment\";\r\nimport Slide from \"@material-ui/core/Slide\";\r\nimport { Dialog } from \"@material-ui/core\";\r\n\r\nconst Transition = React.forwardRef(function Transition(props, ref) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\nclass UserDashboard extends Component {\r\n  state = {\r\n    inputValue: \"\",\r\n    formError: false,\r\n    formSuccess: false,\r\n    formData: {\r\n      description: {\r\n        element: \"description\",\r\n        value: \"\",\r\n        config: {\r\n          placeholder: \"Nói gì đó về bài viết này.....\",\r\n          label: \"Mô tả\",\r\n          name: \"description\",\r\n          options: [],\r\n        },\r\n        validation: {\r\n          required: false,\r\n        },\r\n        valid: true,\r\n        touched: false,\r\n        validationMessage: \"\",\r\n        showlabel: false,\r\n      },\r\n      userTag: {\r\n        element: \"userTag\",\r\n        value: \"\",\r\n        config: {\r\n          placeholder: \"Gắn thẻ bạn bè\",\r\n          label: \"Gắn thẻ\",\r\n          name: \"userTag\",\r\n          options: [],\r\n        },\r\n        validation: {\r\n          required: false,\r\n        },\r\n        valid: true,\r\n        touched: false,\r\n        validationMessage: \"\",\r\n        showlabel: false,\r\n      },\r\n      locationInput: {\r\n        element: \"locationInput\",\r\n        value: \"\",\r\n        config: {\r\n          placeholder: \"Thêm vị trí\",\r\n          label: \"Vị trí\",\r\n          name: \"location\",\r\n          options: [],\r\n        },\r\n        validation: {\r\n          required: false,\r\n        },\r\n        valid: true,\r\n        touched: false,\r\n        validationMessage: \"\",\r\n        showlabel: false,\r\n      },\r\n      images: {\r\n        element: \"select\",\r\n        value: [],\r\n        validation: {\r\n          required: true,\r\n        },\r\n        valid: false,\r\n        touched: false,\r\n        validationMessage: \"\",\r\n        showlabel: false,\r\n      },\r\n    },\r\n\r\n    setfollowerDiaglog: false,\r\n    alertFunctionIsRestricted: false,\r\n\r\n    restrictedFunction: {},\r\n  };\r\n\r\n  updateFields = (newFormData) => {\r\n    this.setState({\r\n      formData: newFormData,\r\n    });\r\n  };\r\n\r\n  updateDescription = (newFormdata) => {\r\n    this.setState((prevState) => ({ formError: false, formData: newFormdata }));\r\n  };\r\n\r\n  updateForm = (element) => {\r\n    const newFormdata = update(element, this.state.formData, \"posts\");\r\n    console.log(newFormdata);\r\n    this.updateDescription(newFormdata);\r\n  };\r\n\r\n  updateFields = (newFormData) => {\r\n    this.setState({\r\n      formData: newFormData,\r\n    });\r\n  };\r\n\r\n  componentDidMount() {\r\n    const formData = this.state.formData;\r\n    //Gọi API lấy danh sách thẻ\r\n    this.props.dispatch(getAllTags()).then((response) => {\r\n      const newFormData = populateOptionFields(\r\n        formData,\r\n        this.props.tags.allTags,\r\n        \"description\"\r\n      );\r\n      this.updateFields(newFormData);\r\n    });\r\n    this.props.dispatch(getUserTag()).then((response) => {\r\n      const newFormData = populateOptionFields(\r\n        formData,\r\n        this.props.tags.userTags,\r\n        \"userTag\"\r\n      );\r\n      this.updateFields(newFormData);\r\n    });\r\n  }\r\n\r\n  imagesHandler = (images) => {\r\n    const newFormData = {\r\n      ...this.state.formData,\r\n    };\r\n    newFormData[\"images\"].value = images;\r\n\r\n    images.length\r\n      ? (newFormData[\"images\"].valid = true)\r\n      : (newFormData[\"images\"].valid = false);\r\n\r\n    this.setState({\r\n      formData: newFormData,\r\n    });\r\n\r\n    console.log(this.state.formData);\r\n  };\r\n\r\n  emojiToggle = () => {\r\n    this.setState({ emojiPicker: !this.state.emojiPicker });\r\n  };\r\n\r\n  onEmojiClick = (event, emojiObject) => {\r\n    this.setState({ emojiObject: emojiObject });\r\n  };\r\n\r\n  findHashtags(Text) {\r\n    var regexp = /\\B\\#\\w\\w+\\b/g;\r\n    let result = Text.match(regexp);\r\n\r\n    if (result) {\r\n      let tags = [];\r\n      result.forEach((item) => {\r\n        tags.push(item.slice(1));\r\n      });\r\n      return tags;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  findUserTag(Text) {\r\n    var regexp = /\\B\\@\\w\\w+\\b/g;\r\n    let result = Text.match(regexp);\r\n\r\n    if (result) {\r\n      let userTag = [];\r\n      result.forEach((item) => {\r\n        userTag.push(item.slice(1));\r\n      });\r\n      return userTag;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  submitForm = (event) => {\r\n    event.preventDefault();\r\n    this.state.formData.locationInput.value =\r\n      document.getElementById(\"input_value\").value;\r\n    let data = generateData(this.state.formData, \"posts\");\r\n    let formIsValid = ifFormValid(this.state.formData, \"posts\");\r\n\r\n    let dataToSubmit = { ...data };\r\n    dataToSubmit.tags = this.findHashtags(data.description);\r\n    dataToSubmit.userTag = this.findUserTag(data.userTag);\r\n    console.log(dataToSubmit);\r\n    if (formIsValid) {\r\n      console.log(dataToSubmit);\r\n      this.props.dispatch(createPost(dataToSubmit)).then((response) => {\r\n        if (response.payload.restricted) {\r\n          console.log(response.payload);\r\n          this.setState({\r\n            alertFunctionIsRestricted: true,\r\n            restrictedFunction: response.payload.restrictedFunction,\r\n          });\r\n        } else {\r\n          console.log(this.props.products);\r\n          if (this.props.products.addProduct.success) {\r\n            this.props.history.push(\"/newfeed\");\r\n          } else {\r\n            this.setState({ formError: true });\r\n          }\r\n        }\r\n      });\r\n    } else {\r\n      this.setState({\r\n        formError: true,\r\n      });\r\n    }\r\n  };\r\n\r\n  resetFieldHandler = () => {\r\n    const newFormData = resetFields(this.state.formData, \"posts\");\r\n    this.setState({\r\n      formSuccess: true,\r\n    });\r\n    setTimeout(() => {\r\n      this.setState(\r\n        {\r\n          formSuccess: false,\r\n        },\r\n        () => {\r\n          this.props.dispatch(clearProduct());\r\n        }\r\n      );\r\n    }, 3000);\r\n  };\r\n\r\n  render() {\r\n    const props = this.props;\r\n    return (\r\n      <Layout>\r\n        <div className=\"create_post\">\r\n          <form class=\"create_post_form\">\r\n            <div className=\"row no-gutters\">\r\n              <div className=\"col-xl-12 col-sm-12 col-12 no-gutters\">\r\n                <div className=\"user_info\">\r\n                  <img className=\"avatar\" src={props.user.userData.avt} />\r\n                  <h5 className=\"userName\">{props.user.userData.userName}</h5>\r\n                </div>\r\n                <FormField\r\n                  id={\"description\"}\r\n                  change={(element) => this.updateForm(element)}\r\n                  formData={this.state.formData.description}\r\n                />\r\n                <div className=\"field_container\">\r\n                  <FormField\r\n                    id={\"userTag\"}\r\n                    change={(element) => this.updateForm(element)}\r\n                    formData={this.state.formData.userTag}\r\n                  />\r\n                  <SearchLocationInput></SearchLocationInput>\r\n                </div>\r\n                <FileUpload\r\n                  imagesHandler={(images) => this.imagesHandler(images)}\r\n                  reset={this.state.formSuccess}\r\n                />\r\n                <button\r\n                  className=\"create_button\"\r\n                  onClick={(event) => {\r\n                    this.submitForm(event);\r\n                  }}\r\n                >\r\n                  Đăng bài\r\n                </button>\r\n                {this.state.formError ? (\r\n                  <p>Hãy thêm ảnh để đăng bài nhé :( </p>\r\n                ) : (\r\n                  <p></p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n        <Dialog\r\n          className=\"dialog_cont\"\r\n          onClose={() => {\r\n            this.setState({ alertFunctionIsRestricted: false });\r\n          }}\r\n          open={this.state.alertFunctionIsRestricted}\r\n        >\r\n          <div className=\"dialog_header\">\r\n            <h5>\r\n              Bạn đã bị hạn chế chức năng này cho đến{\" \"}\r\n              {moment(this.state.restrictedFunction.amountOfTime).format(\"L\")}\r\n            </h5>\r\n          </div>\r\n        </Dialog>\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    user: state.user,\r\n    tags: state.tags,\r\n    products: state.products,\r\n  };\r\n}\r\nexport default connect(mapStateToProps)(withRouter(UserDashboard));\r\n"]},"metadata":{},"sourceType":"module"}